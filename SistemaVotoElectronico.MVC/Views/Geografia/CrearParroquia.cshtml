@model SistemaVoto.Modelos.Parroquia

<div class="container mt-4">
    <div class="card shadow-sm" style="max-width: 600px; margin: auto;">
        <div class="card-header bg-info text-white">
            <h4 class="mb-0">🏠 Nueva Parroquia</h4>
        </div>
        <div class="card-body">

            @if (ViewBag.Error != null)
            {
                <div class="alert alert-danger">@ViewBag.Error</div>
            }

            <form asp-action="CrearParroquia" method="post">

                <div class="form-group mb-3">
                    <label class="font-weight-bold">1. Seleccione Provincia:</label>
                    <select id="ddlProvincia" class="form-control" asp-items="ViewBag.Provincias">
                        <option value="">-- Seleccione una Provincia --</option>
                    </select>
                </div>

                <div class="form-group mb-3">
                    <label class="font-weight-bold">2. Seleccione Cantón:</label>
                    <select asp-for="CantonId" id="ddlCanton" class="form-control" disabled>
                        <option value="">-- Primero seleccione Provincia --</option>
                    </select>
                    <span asp-validation-for="CantonId" class="text-danger"></span>
                </div>

                <div class="form-group mb-3">
                    <label class="font-weight-bold">3. Nombre de la Parroquia:</label>
                    <input asp-for="Nombre" class="form-control" placeholder="Ej: San Francisco" />
                    <span asp-validation-for="Nombre" class="text-danger"></span>
                </div>

                <div class="d-flex justify-content-between">
                    <a asp-action="Index" class="btn btn-secondary">Cancelar</a>
                    <button type="submit" class="btn btn-success">Guardar Parroquia</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Cuando cambie la Provincia...
            $("#ddlProvincia").change(function () {
                var provinciaId = $(this).val();
                var $cantonSelect = $("#ddlCanton");

                // Limpiar el combo de cantones
                $cantonSelect.empty();
                $cantonSelect.append('<option value="">-- Cargando cantones... --</option>');
                $cantonSelect.prop("disabled", true);

                if (provinciaId) {
                    // Hacemos la petición AJAX al servidor
                    $.getJSON('/Geografia/ObtenerCantones', { provinciaId: provinciaId }, function (data) {
                        $cantonSelect.empty();
                        $cantonSelect.append('<option value="">-- Seleccione un Cantón --</option>');

                        // Llenamos el combo con los datos recibidos
                        $.each(data, function (i, item) {
                            $cantonSelect.append($('<option>', {
                                value: item.id,
                                text: item.nombre
                            }));
                        });

                        // Habilitamos el combo
                        $cantonSelect.prop("disabled", false);
                    });
                } else {
                    $cantonSelect.append('<option value="">-- Primero seleccione Provincia --</option>');
                }
            });
        });
    </script>
}